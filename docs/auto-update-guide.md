# 自动更新功能使用指南

## 功能概述

Pointer 应用现在支持完整的自动更新功能，基于 `electron-updater` 实现，包括：

- 应用启动时自动检查更新
- 手动检查更新
- 后台下载更新包
- 安装并重启应用
- 更新进度显示
- 友好的用户通知

## 功能特性

### 🚀 自动检查更新

- 应用启动3秒后自动检查一次更新
- 不会影响应用启动速度
- 检查失败时静默处理，不打扰用户

### 📥 智能下载管理

- 手动控制下载过程，避免不必要的流量消耗
- 实时显示下载进度（速度、百分比、文件大小）
- 下载失败时提供重试选项

### 🔄 安全安装流程

- 更新包下载完成后验证完整性
- 安装前提醒用户保存工作
- 一键安装并重启应用

### 🔔 用户友好的通知

- 发现更新时显示版本信息和更新说明
- 下载完成后提醒安装
- 支持"稍后提醒"和"稍后安装"选项

## 使用方法

### 1. 自动更新通知

当应用检测到新版本时，会在右上角显示通知：

```
发现新版本
新版本 1.0.1 已发布
[立即下载] [稍后提醒]
```

### 2. 手动检查更新

通过设置界面进行手动检查：

1. 打开应用设置
2. 切换到"应用更新"选项卡
3. 点击"检查更新"按钮

### 3. 下载和安装

1. 点击"下载更新"开始下载
2. 等待下载完成（会显示进度条）
3. 下载完成后点击"安装并重启"
4. 应用自动关闭并安装更新
5. 安装完成后应用自动重启

## 设置选项

### 当前版本显示

- 显示应用当前版本号
- 版本号以蓝色徽章形式展示

### 自动检查开关

- 可以关闭自动检查更新功能
- 关闭后仍可手动检查更新

### 更新信息展示

- 新版本号
- 发布名称
- 发布日期
- 详细的更新说明

## 技术实现

### 更新源配置

应用使用 GitHub Releases 作为更新源：

```yaml
# dev-app-update.yml
provider: github
owner: experdot
repo: pointer
updaterCacheDirName: pointer-updater
```

### 构建配置

在 `electron-builder.yml` 中配置发布设置：

```yaml
publish:
  provider: github
  owner: experdot
  repo: pointer
```

### 开发环境测试

开发环境使用 `dev-app-update.yml` 配置文件进行测试。

## 安全说明

1. **数字签名验证**：更新包会自动验证数字签名
2. **HTTPS传输**：所有更新数据通过HTTPS安全传输
3. **完整性校验**：下载完成后验证文件完整性
4. **用户确认**：安装前需要用户明确确认

## 故障排除

### 检查更新失败

- 检查网络连接
- 确认 GitHub 可访问性
- 查看控制台错误信息

### 下载失败

- 检查网络稳定性
- 清理更新缓存目录
- 重试下载操作

### 安装失败

- 确保应用有足够权限
- 关闭杀毒软件临时干扰
- 手动下载最新版本覆盖安装

## 发布流程

### 1. 版本更新

```bash
# 更新 package.json 中的版本号
npm version patch|minor|major
```

### 2. 构建和发布

```bash
# 构建并发布到 GitHub Releases
npm run release
```

### 3. 自动分发

- GitHub Actions 自动构建各平台版本
- 自动创建 Release 页面
- 用户应用自动检测到更新

## 最佳实践

1. **版本控制**：使用语义化版本号（如 1.0.1）
2. **更新说明**：为每个版本编写清晰的更新说明
3. **测试验证**：发布前在测试环境充分测试
4. **渐进发布**：重大更新可考虑分批推送
5. **回滚准备**：保持上一个稳定版本的发布包

## 注意事项

- 更新过程中请勿关闭应用
- 建议在网络稳定时进行更新
- 重要数据请提前备份
- 更新会重启应用，请保存当前工作
